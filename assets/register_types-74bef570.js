import{serializable as a,Behaviour as u,Renderer as X,TypeStore as c,getParam as H,Mathf as y,showBalloonMessage as U,EventList as P,getTempQuaternion as E,getTempVector as v,Context as hi,serializeable as p,Camera as Ut,PointerType as xe,RectTransform as ci,GameObject as w,OrbitControls as we,Text as gt,NeedleXRSession as _e,WebXR as pi,setWorldPosition as pt,Rigidbody as N,AudioSource as zt,InstantiateOptions as ui,InstancingUtil as mi,LODGroup as di,Volume as fi,getWorldPosition as Et,Gizmos as be,ParticleSystem as Pe,setParamWithoutReload as gi,setWorldQuaternion as se,getWorldQuaternion as re,Animator as Oe,WebXRImageTracking as vi,syncField as st,RoomEvents as Lt,delay as et,Animation as Ft,isDevEnvironment as ut,SceneSwitcher as yi,Collider as vt,LogType as xi,WaitForSeconds as wi,ClearFlags as _i,RGBAColor as bi,logHierarchy as oe,AnimationCurve as Pi,AssetReference as Oi,NeedleXRController as ne,XRControllerFollow as Si,delayForFrames as Se,MeshRenderer as Ci,ParticleSystemShapeType as Mt,isDestroyed as Ce,instantiate as Mi,USDZExporter as Di,BehaviorModel as ae,TriggerBuilder as le,ActionBuilder as he}from"./needle-engine-9dc696a7.js";import{S as Ti,U as A,V as b,R as Ri,N as ji,W as At,L as mt,H as Me,a as De,C as Ei,B as Ai,b as ce,M as Te,c as Wt,d as M,e as it,P as Re,f as Bi,g as pe,D as Ii,h as $i,i as Ui,Q as D,j as ct,k as Y,O as V,l as dt,m as je,A as zi}from"./index-3534b4f4.js";import"./index-4f527503.js";class Li extends Ti{constructor(t=new b){super({uniforms:{inputBuffer:new A(null),depthBuffer:new A(null),resolution:new A(new b),texelSize:new A(new b),halfTexelSize:new A(new b),kernel:new A(0),scale:new A(1),cameraNear:new A(0),cameraFar:new A(1),minDepthThreshold:new A(0),maxDepthThreshold:new A(1),depthScale:new A(0),depthToBlurRatioBias:new A(.25)},fragmentShader:`#include <common>
        #include <dithering_pars_fragment>      
        uniform sampler2D inputBuffer;
        uniform sampler2D depthBuffer;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          float depthFactor = 0.0;
          
          #ifdef USE_DEPTH
            vec4 depth = texture2D(depthBuffer, vUv);
            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
            depthFactor *= depthScale;
            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));
          #endif
          
          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));
          gl_FragColor = sum * 0.25 ;

          #include <dithering_fragment>
          #include <tonemapping_fragment>
          #include <${parseInt(Ri.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
        }`,vertexShader:`uniform vec2 texelSize;
        uniform vec2 halfTexelSize;
        uniform float kernel;
        uniform float scale;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          vec2 uv = position.xy * 0.5 + 0.5;
          vUv = uv;

          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;
          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);
          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);
          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);
          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);

          gl_Position = vec4(position.xy, 1.0, 1.0);
        }`,blending:ji,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(t.x,t.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e),this.uniforms.halfTexelSize.value.set(t,e).multiplyScalar(.5)}setResolution(t){this.uniforms.resolution.value.copy(t)}}class Fi{constructor({gl:t,resolution:e,width:s=500,height:i=500,minDepthThreshold:r=0,maxDepthThreshold:n=1,depthScale:h=0,depthToBlurRatioBias:d=.25}){this.renderToScreen=!1,this.renderTargetA=new At(e,e,{minFilter:mt,magFilter:mt,stencilBuffer:!1,depthBuffer:!1,type:Me}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new Li,this.convolutionMaterial.setTexelSize(1/s,1/i),this.convolutionMaterial.setResolution(new b(s,i)),this.scene=new De,this.camera=new Ei,this.convolutionMaterial.uniforms.minDepthThreshold.value=r,this.convolutionMaterial.uniforms.maxDepthThreshold.value=n,this.convolutionMaterial.uniforms.depthScale.value=h,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=d,this.convolutionMaterial.defines.USE_DEPTH=h>0;const g=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),x=new Float32Array([0,0,2,0,0,2]),m=new Ai;m.setAttribute("position",new ce(g,3)),m.setAttribute("uv",new ce(x,2)),this.screen=new Te(m,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(t,e,s){const i=this.scene,r=this.camera,n=this.renderTargetA,h=this.renderTargetB,d=this.convolutionMaterial,g=d.uniforms;g.depthBuffer.value=e.depthTexture;const x=d.kernel;let m=e,R,j,G;for(j=0,G=x.length-1;j<G;++j)R=j&1?h:n,g.kernel.value=x[j],g.inputBuffer.value=m.texture,t.setRenderTarget(R),t.render(i,r),m=R;g.kernel.value=x[j],g.inputBuffer.value=m.texture,t.setRenderTarget(this.renderToScreen?null:s),t.render(i,r)}}class Wi extends Wt{constructor(t={}){super(),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(t)}onBeforeCompile(t){var e;(e=t.defines)!=null&&e.USE_UV||(t.defines.USE_UV=""),t.uniforms.hasBlur=this._hasBlur,t.uniforms.tDiffuse=this._tDiffuse,t.uniforms.tDepth=this._tDepth,t.uniforms.distortionMap=this._distortionMap,t.uniforms.tDiffuseBlur=this._tDiffuseBlur,t.uniforms.textureMatrix=this._textureMatrix,t.uniforms.mirror=this._mirror,t.uniforms.mixBlur=this._mixBlur,t.uniforms.mixStrength=this._blurStrength,t.uniforms.minDepthThreshold=this._minDepthThreshold,t.uniforms.maxDepthThreshold=this._maxDepthThreshold,t.uniforms.depthScale=this._depthScale,t.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,t.uniforms.distortion=this._distortion,t.uniforms.mixContrast=this._mixContrast,t.vertexShader=`
        uniform mat4 textureMatrix;
        varying vec4 my_vUv;
      ${t.vertexShader}`,t.vertexShader=t.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
        my_vUv = textureMatrix * vec4( position, 1.0 );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );`),t.fragmentShader=`
        uniform sampler2D tDiffuse;
        uniform sampler2D tDiffuseBlur;
        uniform sampler2D tDepth;
        uniform sampler2D distortionMap;
        uniform float distortion;
        uniform float cameraNear;
			  uniform float cameraFar;
        uniform bool hasBlur;
        uniform float mixBlur;
        uniform float mirror;
        uniform float mixStrength;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float mixContrast;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec4 my_vUv;
        ${t.fragmentShader}`,t.fragmentShader=t.fragmentShader.replace("#include <emissivemap_fragment>",`#include <emissivemap_fragment>

      float distortionFactor = 0.0;
      #ifdef USE_DISTORTION
        distortionFactor = texture2D(distortionMap, vUv).r * distortion;
      #endif

      vec4 new_vUv = my_vUv;
      new_vUv.x += distortionFactor;
      new_vUv.y += distortionFactor;

      vec4 base = texture2DProj(tDiffuse, new_vUv);
      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);

      vec4 merge = base;

      #ifdef USE_NORMALMAP
        vec2 normal_uv = vec2(0.0);
        vec4 normalColor = texture2D(normalMap, vUv * normalScale);
        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );
        vec3 coord = new_vUv.xyz / new_vUv.w;
        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;
        vec4 base_normal = texture2D(tDiffuse, normal_uv);
        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);
        merge = base_normal;
        blur = blur_normal;
      #endif

      float depthFactor = 0.0001;
      float blurFactor = 0.0;

      #ifdef USE_DEPTH
        vec4 depth = texture2DProj(tDepth, new_vUv);
        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
        depthFactor *= depthScale;
        depthFactor = max(0.0001, min(1.0, depthFactor));

        #ifdef USE_BLUR
          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);
          merge = merge * min(1.0, depthFactor + 0.5);
        #else
          merge = merge * depthFactor;
        #endif

      #endif

      float reflectorRoughnessFactor = roughness;
      #ifdef USE_ROUGHNESSMAP
        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );
        reflectorRoughnessFactor *= reflectorTexelRoughness.g;
      #endif

      #ifdef USE_BLUR
        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);
        merge = mix(merge, blur, blurFactor);
      #endif

      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);
      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;
      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;
      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;

      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);
      `)}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(t){this._tDiffuse.value=t}get tDepth(){return this._tDepth.value}set tDepth(t){this._tDepth.value=t}get distortionMap(){return this._distortionMap.value}set distortionMap(t){this._distortionMap.value=t}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(t){this._tDiffuseBlur.value=t}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(t){this._textureMatrix.value=t}get hasBlur(){return this._hasBlur.value}set hasBlur(t){this._hasBlur.value=t}get mirror(){return this._mirror.value}set mirror(t){this._mirror.value=t}get mixBlur(){return this._mixBlur.value}set mixBlur(t){this._mixBlur.value=t}get mixStrength(){return this._blurStrength.value}set mixStrength(t){this._blurStrength.value=t}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(t){this._minDepthThreshold.value=t}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(t){this._maxDepthThreshold.value=t}get depthScale(){return this._depthScale.value}set depthScale(t){this._depthScale.value=t}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(t){this._depthToBlurRatioBias.value=t}get distortion(){return this._distortion.value}set distortion(t){this._distortion.value=t}get mixContrast(){return this._mixContrast.value}set mixContrast(t){this._mixContrast.value=t}}var Vi=Object.defineProperty,Ni=Object.getOwnPropertyDescriptor,B=(o,t,e,s)=>{for(var i=s>1?void 0:s?Ni(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&Vi(t,e,i),i};const Ee=class extends u{constructor(){super(...arguments),this.mixBlur=1,this.mixStrength=5,this.mirror=0,this.distortion=.25,this.mixContrast=1,this.reflectorOffset=0,this.resolution=1024,this.blurX=1024,this.blurY=1024,this.minDepthThreshold=0,this.maxDepthThreshold=1,this.depthScale=1,this.depthToBlurRatioBias=.25,this.reflectorWorldPosition=new M,this.cameraWorldPosition=new M,this.rotationMatrix=new it,this.normal=new M,this.view=new M,this.lookAtPosition=new M,this.target=new M,this.virtualCamera=new Re,this.textureMatrix=new it,this.reflectorPlane=new Bi,this.clipPlane=new pe,this.q=new pe}get hasBlur(){return this.blurX+this.blurY>0}awake(){this.setupBuffers(),this.replaceMaterials()}getPropertyDifferences(o,t){return Object.entries(o).reduce((e,[s,i])=>{if(t.hasOwnProperty(s)){const r=t[s];if(r!==i)return{...e,[s]:r}}return e},{})}onBeforeRender(){this.updateReflection(),this.renderVirtualCamera()}replaceMaterials(){const o=this.gameObject.getComponent(X);if(o)for(let t=0;t<o.sharedMaterials.length;t++){const e=o.sharedMaterials[t];if(e instanceof Wt){const s={};Object.assign(s,{color:e.color,roughness:e.roughness,metalness:e.metalness,map:e.map,lightMap:e.lightMap,lightMapIntensity:e.lightMapIntensity,aoMap:e.aoMap,aoMapIntensity:e.aoMapIntensity,emissive:e.emissive,emissiveIntensity:e.emissiveIntensity,emissiveMap:e.emissiveMap,bumpMap:e.bumpMap,bumpScale:e.bumpScale,normalMap:e.normalMap,normalMapType:e.normalMapType,normalScale:e.normalScale,displacementMap:e.displacementMap,displacementScale:e.displacementScale,displacementBias:e.displacementBias,roughnessMap:e.roughnessMap,metalnessMap:e.metalnessMap,alphaMap:e.alphaMap,envMap:e.envMap,envMapRotation:e.envMapRotation,envMapIntensity:e.envMapIntensity,wireframe:e.wireframe,wireframeLinewidth:e.wireframeLinewidth,fog:e.fog,flatShading:e.flatShading}),Object.assign(s,{mixBlur:this.mixBlur,mixStrength:this.mixStrength,mirror:this.mirror,textureMatrix:this.textureMatrix,tDiffuse:e.map,tDiffuseBlur:this.fbo2.texture,hasBlur:this.hasBlur,minDepthThreshold:this.minDepthThreshold,maxDepthThreshold:this.maxDepthThreshold,depthScale:this.depthScale,depthToBlurRatioBias:this.depthToBlurRatioBias,distortion:this.distortion,mixContrast:this.mixContrast});const i=new Wi(s);delete i.defines.STANDARD,i.defines.USE_BLUR="",i.defines.USE_DEPTH="",Ee.materials.push(i),o.sharedMaterials[t]=i}}}setupBuffers(){const o={minFilter:mt,magFilter:mt,type:Me};this.fbo1=new At(this.resolution,this.resolution,o),this.fbo1.depthBuffer=!0,this.fbo1.depthTexture=new Ii(this.resolution,this.resolution),this.fbo1.depthTexture.format=$i,this.fbo1.depthTexture.type=Ui,this.fbo2=new At(this.resolution,this.resolution,o);const t=this.context.renderer;this.blurPass=new Fi({gl:t,resolution:this.resolution,width:this.blurX,height:this.blurY,minDepthThreshold:this.minDepthThreshold,maxDepthThreshold:this.maxDepthThreshold,depthScale:this.depthScale,depthToBlurRatioBias:this.depthToBlurRatioBias})}updateReflection(){const o=this.gameObject,t=this.context.mainCamera;if(!o||!o.isMesh||!t||!t.isPerspectiveCamera)return;this.reflectorWorldPosition.setFromMatrixPosition(o.matrixWorld),this.cameraWorldPosition.setFromMatrixPosition(t.matrixWorld),this.rotationMatrix.extractRotation(o.matrixWorld),this.normal.set(0,0,-1),this.normal.applyMatrix4(this.rotationMatrix),this.reflectorWorldPosition.addScaledVector(this.normal,this.reflectorOffset),this.view.subVectors(this.reflectorWorldPosition,this.cameraWorldPosition),this.view.reflect(this.normal).negate(),this.view.add(this.reflectorWorldPosition),this.rotationMatrix.extractRotation(t.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition),this.target.subVectors(this.reflectorWorldPosition,this.lookAtPosition),this.target.reflect(this.normal).negate(),this.target.add(this.reflectorWorldPosition),this.virtualCamera.position.copy(this.view),this.virtualCamera.up.set(0,1,0),this.virtualCamera.up.applyMatrix4(this.rotationMatrix),this.virtualCamera.up.reflect(this.normal),this.virtualCamera.lookAt(this.target),this.virtualCamera.far=t.far,this.virtualCamera.updateMatrixWorld(),this.virtualCamera.projectionMatrix.copy(t.projectionMatrix),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.virtualCamera.projectionMatrix),this.textureMatrix.multiply(this.virtualCamera.matrixWorldInverse),this.textureMatrix.multiply(o.matrixWorld),this.reflectorPlane.setFromNormalAndCoplanarPoint(this.normal,this.reflectorWorldPosition),this.reflectorPlane.applyMatrix4(this.virtualCamera.matrixWorldInverse),this.clipPlane.set(this.reflectorPlane.normal.x,this.reflectorPlane.normal.y,this.reflectorPlane.normal.z,this.reflectorPlane.constant);const e=this.virtualCamera.projectionMatrix;this.q.x=(Math.sign(this.clipPlane.x)+e.elements[8])/e.elements[0],this.q.y=(Math.sign(this.clipPlane.y)+e.elements[9])/e.elements[5],this.q.z=-1,this.q.w=(1+e.elements[10])/e.elements[14],this.clipPlane.multiplyScalar(2/this.clipPlane.dot(this.q)),e.elements[2]=this.clipPlane.x,e.elements[6]=this.clipPlane.y,e.elements[10]=this.clipPlane.z+1,e.elements[14]=this.clipPlane.w}renderVirtualCamera(){const o=this.context.renderer;this.gameObject.visible=!1;const t=o.xr.enabled,e=o.shadowMap.autoUpdate;o.xr.enabled=!1,o.shadowMap.autoUpdate=!1,o.setRenderTarget(this.fbo1),o.state.buffers.depth.setMask(!0),o.autoClear||o.clear(),o.render(this.context.scene,this.virtualCamera),this.hasBlur&&this.blurPass.render(o,this.fbo1,this.fbo2),o.xr.enabled=t,o.shadowMap.autoUpdate=e,this.gameObject.visible=!0,o.setRenderTarget(null)}};let O=Ee;O.materials=[];O.debug=!1;B([a()],O.prototype,"mixBlur",2);B([a()],O.prototype,"mixStrength",2);B([a()],O.prototype,"mirror",2);B([a()],O.prototype,"distortion",2);B([a()],O.prototype,"mixContrast",2);B([a()],O.prototype,"reflectorOffset",2);B([a()],O.prototype,"resolution",2);B([a()],O.prototype,"blurX",2);B([a()],O.prototype,"blurY",2);B([a()],O.prototype,"minDepthThreshold",2);B([a()],O.prototype,"maxDepthThreshold",2);B([a()],O.prototype,"depthScale",2);B([a()],O.prototype,"depthToBlurRatioBias",2);c.add("ReflectiveMaterial",O);var qi=Object.defineProperty,Gi=Object.getOwnPropertyDescriptor,Ae=(o,t,e,s)=>{for(var i=s>1?void 0:s?Gi(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&qi(t,e,i),i};const Dt=H("debugtonemapping");var Be=(o=>(o[o.NoToneMapping=0]="NoToneMapping",o[o.LinearToneMapping=1]="LinearToneMapping",o[o.ReinhardToneMapping=2]="ReinhardToneMapping",o[o.CineonToneMapping=3]="CineonToneMapping",o[o.ACESFilmicToneMapping=4]="ACESFilmicToneMapping",o[o.CustomToneMapping=5]="CustomToneMapping",o[o.AgXToneMapping=6]="AgXToneMapping",o[o.NeutralToneMapping=7]="NeutralToneMapping",o))(Be||{});class Vt extends u{constructor(){super(...arguments),this.method=7,this.exposure=1,this.state=!1}awake(){this.toggle()}update(){if(!Dt)return;const t=this.context.input;t.isKeyDown("f")&&this.toggle(),t.isKeyDown("g")&&(this.method=y.clamp(--this.method,0,7),this.set(this.method,this.exposure)),t.isKeyDown("h")&&(this.method=y.clamp(++this.method,0,7),this.set(this.method,this.exposure)),t.isKeyDown("j")&&(this.exposure=y.clamp(this.exposure-.1,0,5),this.set(this.method,this.exposure)),t.isKeyDown("k")&&(this.exposure=y.clamp(this.exposure+.1,0,5),this.set(this.method,this.exposure))}toggle(){this.state=!this.state,this.state?(Dt&&console.log(),this.prevToneMapping=this.context.renderer.toneMapping,this.prevExposure=this.context.renderer.toneMappingExposure,this.set(this.method,this.exposure)):(this.context.renderer.toneMapping=this.prevToneMapping??0,this.context.renderer.toneMappingExposure=this.prevExposure??1)}set(t,e){this.context.renderer.toneMapping=t,this.context.renderer.toneMappingExposure=e,Dt&&U(`Tonemapping | Method: ${Be[this.context.renderer.toneMapping]} | Exposure: ${this.context.renderer.toneMappingExposure.toFixed(1)}`)}}Ae([a()],Vt.prototype,"method",2);Ae([a()],Vt.prototype,"exposure",2);const ue=H("debuggyro");class Nt{constructor(){this.onFail=new P,this.currentHandler=null,this._isActive=!1,this.sensorOrientation=new Ue,this.deviceOrientation=new $e}get handler(){return this.currentHandler}get isConnected(){var t;return((t=this.handler)==null?void 0:t.isConnected)||!1}get quaternion(){var t;return((t=this.handler)==null?void 0:t.quaternion)||null}getDelta(t){return this.quaternion?(me.copy(this.quaternion),Tt.copy(t).invert(),Tt.multiply(me),Tt):null}get isActive(){return this._isActive}activate(){this._isActive=!0,this.sensorOrientation.initialize(()=>{this.currentHandler=this.sensorOrientation},t=>{ue&&console.error("OrientationSensor: ",t),this.deviceOrientation.initialize(()=>{this.currentHandler=this.deviceOrientation},e=>{ue&&console.error("DeviceMotion: ",e),this.onFail.invoke({msg:e}),this._isActive=!1})})}deactivate(){this._isActive=!1,this.sensorOrientation.disconnect(),this.deviceOrientation.disconnect()}}const Hi=function(){return window.screen.orientation?window.screen.orientation.angle:typeof window.orientation=="number"?window.orientation:window.screen.mozOrientation?{"portrait-primary":0,"portrait-secondary":180,"landscape-primary":90,"landscape-secondary":270}[window.screen.mozOrientation]:0},me=new D,Tt=new D;class Ie{constructor(){this.isConnected=!1,this.isInitialized=!1,this._quaternion=new D}get quaternion(){return this._quaternion}connect(){this.isConnected=!0,this.isInitialized=!0}disconnect(){this.isConnected=!1}handleGyroscope(t,e){const s=E().setFromAxisAngle(v(1,0,0),-Math.PI/2);this._quaternion.copy(s.multiply(t));const i=Hi(),r=E().setFromAxisAngle(v(0,0,-1),ct.degToRad(i));this._quaternion.multiply(r),this._quaternion.copy(e?this.applyGyroYRelativity(this._quaternion):this._quaternion)}applyGyroYRelativity(t){this.initialQuaternion||(this.initialQuaternion=new D().copy(t));const e=v(0,0,1).applyQuaternion(this.initialQuaternion),s=v(0,0,1).applyQuaternion(t);e.y=0,s.y=0,e.normalize(),s.normalize();let i=2*Math.PI-e.angleTo(v(0,0,1));return v(0,1,0).dot(e)<0&&(i*=-1),E().setFromAxisAngle(v(0,1,0),i).multiply(t)}}class $e extends Ie{constructor(){super(),this.connectFromClick=!1,this.deviceorientation=t=>{if(!t.alpha||!t.beta||!t.gamma)return;const e=ct.degToRad(t.alpha),s=ct.degToRad(t.beta),i=ct.degToRad(t.gamma),r=E().setFromAxisAngle(v(0,0,1),e),n=E().setFromAxisAngle(v(1,0,0),s),h=E().setFromAxisAngle(v(0,1,0),i),d=E().set(0,0,0,1);d.multiply(r).multiply(n).multiply(h),this.handleGyroscope(d,!0)},hi.Current.domElement.addEventListener("click",()=>{this.tryConnectOnClick()})}connect(){super.connect(),window.addEventListener("deviceorientation",this.deviceorientation)}disconnect(){super.disconnect(),window.removeEventListener("deviceorientation",this.deviceorientation)}initialize(t,e){"DeviceMotionEvent"in globalThis?t==null||t():e==null||e("DeviceMotionEvent not supported."),this.connectFromClick=!0}tryConnectOnClick(){this.isConnected||this.connectFromClick&&("requestPermission"in DeviceMotionEvent?DeviceMotionEvent.requestPermission().then(t=>{t=="granted"&&this.connect()}):this.connect())}}class Ue extends Ie{connect(){var t;super.connect(),(t=this.sensor)==null||t.start()}disconnect(){var t;super.disconnect(),(t=this.sensor)==null||t.stop()}initialize(t,e){if(this.isInitialized){this.connect();return}try{this.sensor=new RelativeOrientationSensor({frequency:60}),this.sensor.addEventListener("error",s=>{s.error.name==="NotAllowedError"?e==null||e("Permission to access sensor was denied."):s.error.name==="NotReadableError"?e==null||e("Cannot connect to the sensor."):e==null||e(`RelativeOrientationSensor error: ${s.error.name}`)}),this.sensor.addEventListener("reading",s=>{if(this.sensor){const i=E().fromArray(this.sensor.quaternion);this.handleGyroscope(i,!0)}}),Promise.all([navigator.permissions.query({name:"accelerometer"}),navigator.permissions.query({name:"gyroscope"})]).then(s=>{s.every(i=>i.state==="granted")?(this.connect(),t==null||t()):e==null||e("No permissions to use RelativeOrientationSensor.")})}catch(s){if(!(s instanceof Error))return;this.disconnect(),s.name==="SecurityError"?e==null||e("Sensor construction was blocked by the Permissions Policy."):s.name==="ReferenceError"?e==null||e("Sensor is not supported by the User Agent."):e==null||e(s.message)}}}var Qi=Object.defineProperty,Zi=Object.getOwnPropertyDescriptor,S=(o,t,e,s)=>{for(var i=s>1?void 0:s?Zi(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&Qi(t,e,i),i};const Q=new Y,Xi=new D,Rt=new b,de=new b;class _ extends u{constructor(){super(...arguments),this.gyroscope=new Nt,this.spherical=new Y,this.sphericalTarget=new Y,this.gyroscopeInput=!0,this.pointerInput=!0,this.rotateSpeed=1,this.rotateSmoothing=5,this.enableZoom=!0,this.zoomMin=40,this.zoomMax=90,this.zoomSpeed=.1,this.zoomSmoothing=5,this.autoRotate=!0,this.autoRotateSpeed=.15,this.autoRotateTimeout=3,this.autoRotatePhi=0,this.snappigMode=!1,this.snappingGoals=4,this.snappingOffset=0,this.originPosition=new M,this.currentZoom=0,this.initialQuterion=new D,this.userInputStamp=Number.MIN_SAFE_INTEGER,this.lastGyro=new D,this.isPointerInput=!1,this.previousPinchDistance=void 0,this.previousDelta=0}start(){this.initialQuterion.copy(this.gameObject.quaternion),this.originPosition.copy(this.gameObject.position),this.camera=this.gameObject.getComponent(Ut),this.gyroscope.onFail.addEventListener(()=>{this.dispatchEvent(new Event("onfail"))}),this.currentZoom=y.lerp(this.zoomMin,this.zoomMax,.5),this.camera&&(this.currentZoom=this.camera.fieldOfView),this.sphericalTarget.theta=this.spherical.theta=Math.PI*2}onBeforeRender(){this.gyroscope.isActive!==this.gyroscopeInput&&(this.gyroscopeInput?this.gyroscope.activate():this.gyroscope.deactivate()),this.gyroscopeInput&&this.handleGyro(),this.pointerInput&&this.handleInput(),this.enableZoom&&this.handleZoom(),this.autoRotate&&this.handleAutoRotate(),this.snappigMode&&!this.isPointerInput&&this.handleSnapping(),this.applyRotationAndPosition()}applyRotationAndPosition(){const t=Math.PI/2-.085;this.spherical.phi=y.clamp(this.spherical.phi,-t,t),this.sphericalTarget.phi=y.clamp(this.sphericalTarget.phi,-t,t);const e=this.context.time.deltaTime;this.spherical.phi=y.lerp(this.spherical.phi,this.sphericalTarget.phi,e*this.rotateSmoothing),this.spherical.theta=y.lerp(this.spherical.theta,this.sphericalTarget.theta,e*this.rotateSmoothing);const s=E().setFromAxisAngle(v(1,0,0),this.spherical.phi),i=E().setFromAxisAngle(v(0,1,0),this.spherical.theta),r=v(0,0,1).applyQuaternion(s).applyQuaternion(i),n=v(this.originPosition).add(r.multiplyScalar(this.currentZoom));this.gameObject.position.copy(n),this.gameObject.lookAt(this.originPosition)}handleAutoRotate(){const t=this.context.time.time,e=this.context.time.deltaTime;t-this.userInputStamp>this.autoRotateTimeout&&(this.sphericalTarget.theta+=this.autoRotateSpeed*e,this.sphericalTarget.phi=this.autoRotatePhi)}handleInput(){const t=this.context.input,e=this.context.renderer.domElement;if(this.isPointerInput=t.getPointerPressedCount()==1,this.isPointerInput){const s=t.getPointerPositionDelta(0),i=this.rotateSpeed;this.sphericalTarget.phi+=2*Math.PI*s.y/e.clientHeight*i,this.sphericalTarget.theta+=2*Math.PI*s.x/e.clientWidth*i,this.userInputStamp=this.context.time.time}}handleZoom(){const t=this.getZoomInput();this.currentZoom+=t*this.zoomSpeed,this.currentZoom=y.clamp(this.currentZoom,this.zoomMin,this.zoomMax),Math.abs(t)>Number.EPSILON&&(this.userInputStamp=this.context.time.time)}handleGyro(){if(!this.gyroscope.isConnected)return;const t=this.gyroscope.quaternion,e=this.gyroscope.getDelta(this.lastGyro);if(t&&e){this.initialTargetRotation||(this.initialTargetRotation=this.gameObject.quaternion.clone());const s=v(0,0,1).applyQuaternion(e);Q.setFromVector3(s),Q.phi-=Math.PI/2,this.spherical.phi-=Q.phi,this.sphericalTarget.phi-=Q.phi,this.spherical.theta+=Q.theta,this.sphericalTarget.theta+=Q.theta,this.lastGyro.copy(t),e.angleTo(Xi)>.001&&(this.userInputStamp=this.context.time.time)}}getZoomInput(){let t=0;const e=this.context.input;if(t=e.getMouseWheelDeltaY()*.1,e.getTouchesPressedCount()==2){for(const i of e.foreachPointerId(xe.Touch)){const r=e.getPointerPosition(i);de.copy(Rt),Rt.copy(r)}const s=Rt.distanceTo(de);this.previousPinchDistance&&(t+=this.previousPinchDistance-s),this.previousPinchDistance=s}else this.previousPinchDistance=void 0;return t}get stepSize(){return 2*Math.PI/(this.snappingGoals*2)}get stepOffset(){return this.stepSize*this.snappingOffset}getStep(t){return Math.floor((t-this.stepOffset)/this.stepSize)}getTheta(t){return t*this.stepSize+this.stepOffset}handleSnapping(){const t=this.getStep(this.spherical.theta),s=this.getStep(this.sphericalTarget.theta)-t;if(s!=this.previousDelta&&(this.previousDelta=s,s!=0)){const i=this.getTheta(t+s+s)+s*.1;this.sphericalTarget.theta=i}}makeSafeSpherical(t){t.phi=this.makeSafe(t.phi),t.theta=this.makeSafe(t.theta)}makeSafe(t){return Math.abs(this.spherical.theta)<Math.PI?Math.PI*2+t%Math.PI:t}}S([p()],_.prototype,"gyroscopeInput",2);S([p()],_.prototype,"pointerInput",2);S([p()],_.prototype,"rotateSpeed",2);S([p()],_.prototype,"rotateSmoothing",2);S([p()],_.prototype,"enableZoom",2);S([p()],_.prototype,"zoomMin",2);S([p()],_.prototype,"zoomMax",2);S([p()],_.prototype,"zoomSpeed",2);S([p()],_.prototype,"zoomSmoothing",2);S([p()],_.prototype,"autoRotate",2);S([p()],_.prototype,"autoRotateSpeed",2);S([p()],_.prototype,"autoRotateTimeout",2);S([p()],_.prototype,"autoRotatePhi",2);S([p()],_.prototype,"snappigMode",2);S([p()],_.prototype,"snappingGoals",2);S([p()],_.prototype,"snappingOffset",2);var Yi=Object.defineProperty,Ki=Object.getOwnPropertyDescriptor,z=(o,t,e,s)=>{for(var i=s>1?void 0:s?Ki(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&Yi(t,e,i),i};const Z=new Y,fe=90,Ji=new D,jt=new b,ge=new b;class I extends u{constructor(){super(...arguments),this.gyroscope=new Nt,this.spherical=new Y,this.sphericalTarget=new Y,this.gyroscopeInput=!0,this.pointerInput=!0,this.rotateSpeed=1,this.rotateSmoothing=5,this.enableZoom=!0,this.zoomMin=40,this.zoomMax=90,this.zoomSpeed=.1,this.zoomSmoothing=5,this.autoRotate=!0,this.autoRotateSpeed=.15,this.autoRotateTimeout=3,this.currentZoom=0,this.initialQuterion=new D,this.userInputStamp=Number.MIN_SAFE_INTEGER,this.lastGyro=new D,this.previousPinchDistance=void 0}start(){this.initialQuterion.copy(this.gameObject.quaternion),this.camera=this.gameObject.getComponent(Ut),onFail,this.gyroscope.onFial.addEventListener(()=>{this.dispatchEvent(new Event("onfail"))}),this.currentZoom=y.lerp(this.zoomMin,this.zoomMax,.5),this.camera&&(this.currentZoom=this.camera.fieldOfView)}onBeforeRender(){this.gyroscope.isActive!==this.gyroscopeInput&&(this.gyroscopeInput?this.gyroscope.activate():this.gyroscope.deactivate()),this.gyroscopeInput&&this.handleGyro(),this.pointerInput&&this.handleInput(),this.enableZoom&&this.handleZoom(),this.autoRotate&&this.handleAutoRotate(),this.applyRotation()}applyRotation(){const t=Math.PI/2-.085;this.spherical.phi=y.clamp(this.spherical.phi,-t,t),this.sphericalTarget.phi=y.clamp(this.sphericalTarget.phi,-t,t);const e=this.context.time.deltaTime;this.spherical.phi=y.lerp(this.spherical.phi,this.sphericalTarget.phi,e*this.rotateSmoothing),this.spherical.theta=y.lerp(this.spherical.theta,this.sphericalTarget.theta,e*this.rotateSmoothing),this.gameObject.quaternion.copy(this.initialQuterion);const s=E().setFromAxisAngle(v(1,0,0),this.spherical.phi),i=E().setFromAxisAngle(v(0,1,0),this.spherical.theta);this.gameObject.quaternion.copy(this.initialQuterion);const r=v(this.gameObject.position).add(v(0,0,1).applyQuaternion(s).applyQuaternion(i));this.gameObject.lookAt(r)}handleAutoRotate(){const t=this.context.time.time,e=this.context.time.deltaTime;t-this.userInputStamp>this.autoRotateTimeout&&(this.sphericalTarget.theta+=this.autoRotateSpeed*e,this.sphericalTarget.phi=0)}handleInput(){var s;const t=this.context.input,e=this.context.renderer.domElement;if(t.getPointerPressedCount()==1){const i=t.getPointerPositionDelta(0),r=this.rotateSpeed*(((s=this.camera)==null?void 0:s.fieldOfView)??fe)/fe;this.sphericalTarget.phi+=2*Math.PI*i.y/e.clientHeight*r,this.sphericalTarget.theta-=2*Math.PI*i.x/e.clientWidth*r,this.userInputStamp=this.context.time.time}}handleZoom(){const t=this.getZoomInput();if(this.currentZoom+=t*this.zoomSpeed,this.currentZoom=y.clamp(this.currentZoom,this.zoomMin,this.zoomMax),this.camera){const e=this.context.time.deltaTime;this.camera.fieldOfView=y.lerp(this.camera.fieldOfView??0,this.currentZoom,this.zoomSmoothing*e)}Math.abs(t)>Number.EPSILON&&(this.userInputStamp=this.context.time.time)}handleGyro(){if(!this.gyroscope.isConnected)return;const t=this.gyroscope.quaternion,e=this.gyroscope.getDelta(this.lastGyro);if(t&&e){this.initialTargetRotation||(this.initialTargetRotation=this.gameObject.quaternion.clone());const s=v(0,0,1).applyQuaternion(e);Z.setFromVector3(s),Z.phi-=Math.PI/2,this.spherical.phi-=Z.phi,this.sphericalTarget.phi-=Z.phi,this.spherical.theta+=Z.theta,this.sphericalTarget.theta+=Z.theta,this.lastGyro.copy(t),e.angleTo(Ji)>.001&&(this.userInputStamp=this.context.time.time)}}getZoomInput(){let t=0;const e=this.context.input;if(t=e.getMouseWheelDeltaY()*.1,e.getTouchesPressedCount()==2){for(const i of e.foreachPointerId(xe.Touch)){const r=e.getPointerPosition(i);ge.copy(jt),jt.copy(r)}const s=jt.distanceTo(ge);this.previousPinchDistance&&(t+=this.previousPinchDistance-s),this.previousPinchDistance=s}else this.previousPinchDistance=void 0;return t}}z([p()],I.prototype,"gyroscopeInput",2);z([p()],I.prototype,"pointerInput",2);z([p()],I.prototype,"rotateSpeed",2);z([p()],I.prototype,"rotateSmoothing",2);z([p()],I.prototype,"enableZoom",2);z([p()],I.prototype,"zoomMin",2);z([p()],I.prototype,"zoomMax",2);z([p()],I.prototype,"zoomSpeed",2);z([p()],I.prototype,"zoomSmoothing",2);z([p()],I.prototype,"autoRotate",2);z([p()],I.prototype,"autoRotateSpeed",2);z([p()],I.prototype,"autoRotateTimeout",2);c.add("ThreeTonemapping",Vt);c.add("GalleryControls",_);c.add("Gyroscope",Nt);c.add("DeviceMotion",$e);c.add("OrientationSensor",Ue);c.add("PanoramaControls",I);var ki=Object.defineProperty,ts=Object.getOwnPropertyDescriptor,ze=(o,t,e,s)=>{for(var i=s>1?void 0:s?ts(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&ki(t,e,i),i};class qt extends u{constructor(){super(...arguments),this.safeArea=new b(0,0)}update(){var i,r;const t=this.context.domWidth/this.safeArea.x,e=this.context.domHeight/this.safeArea.y,s=y.clamp(Math.min(t,e),0,1);(r=(i=this.rectTransform)==null?void 0:i.shadowComponent)==null||r.scale.setScalar(s)}}ze([a(ci)],qt.prototype,"rectTransform",2);ze([a(b)],qt.prototype,"safeArea",2);var es=Object.defineProperty,is=Object.getOwnPropertyDescriptor,Gt=(o,t,e,s)=>{for(var i=s>1?void 0:s?is(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&es(t,e,i),i};class yt extends u{constructor(){super(...arguments),this.createMenuButton=!1,this.teleportVRPlayer=!1,this.ignoreYInVR=!1,this.menuButton=null}get orbitalCamera(){return this._orbitalCamera??(this._orbitalCamera=w.findObjectOfType(we)),this._orbitalCamera}awake(){this.createMenuButton&&this.addButton()}addButton(){var s;this.menuButton&&this.removeButton();const t=((s=this.gameObject.getComponentInChildren(gt))==null?void 0:s.text)??this.gameObject.name,e=document.createElement("button");this.menuButton=e,e.innerText=t.replace("_"," "),e.setAttribute("priority","40"),e.addEventListener("click",()=>this.use()),this.context.menu.appendChild(e)}removeButton(){this.menuButton&&(this.menuButton.remove(),this.menuButton=null)}use(){var e,s;(e=this.orbitalCamera)==null||e.setCameraTargetPosition(this.worldPosition);const t=(s=_e.active)==null?void 0:s.rig;if(this.teleportVRPlayer&&this.context.isInVR&&t){const i=v(this.worldPosition);this.ignoreYInVR&&(i.y=t.gameObject.worldPosition.y),t.gameObject.worldPosition=i}}}Gt([a()],yt.prototype,"createMenuButton",2);Gt([a()],yt.prototype,"teleportVRPlayer",2);Gt([a()],yt.prototype,"ignoreYInVR",2);class ss extends u{constructor(){super(...arguments),this.cam=null}onEnable(){this.cam=this.gameObject.getComponent(Ut),this.cam||(console.warn("CameraLayer requires a Camera component"),this.enabled=!1)}onAfterRender(){if(!this.cam)return;const t=this.scene.background;this.context.renderer.autoClearColor=!1,this.cam.cam instanceof Re&&this.context.updateAspect(this.cam.cam),this.scene.background=null,this.context.renderer.render(this.scene,this.cam.cam),this.scene.background=t}}var rs=Object.defineProperty,os=Object.getOwnPropertyDescriptor,xt=(o,t,e,s)=>{for(var i=s>1?void 0:s?os(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&rs(t,e,i),i};class rt extends u{constructor(){super(...arguments),this.strength=10,this.maxInstances=10,this._instances=[],this._index=-1,this._onPointerDown=t=>{t.button===0&&this.throwBall(t.space.worldPosition,t.space.worldForward)}}start(){this.prefab&&w.setActive(this.prefab,!1),this.webXR??(this.webXR=w.findObjectOfType(pi))}onEnable(){this.context.input.addEventListener("pointerdown",this._onPointerDown)}onDisable(){this.context.input.removeEventListener("pointerdown",this._onPointerDown)}throwBall(t,e){var n,h;if(!this.prefab)return;if(this._instances.length<this.maxInstances){const d=new ui;d.position=t;const g=w.instantiate(this.prefab,d);if(!g)return;this._instances.push(g)}const s=++this._index,i=this._instances[s%this._instances.length];if(!i)return;pt(i,t),w.setActive(i,!0),(n=this.audioSource)==null||n.stop(),(h=this.audioSource)==null||h.play();const r=w.getComponent(i,N);r&&(e.multiplyScalar(this.strength),r.resetForcesAndTorques(),r.resetVelocities(),r==null||r.applyImpulse(e))}}xt([p(V)],rt.prototype,"prefab",2);xt([p(zt)],rt.prototype,"audioSource",2);xt([p()],rt.prototype,"strength",2);xt([p()],rt.prototype,"maxInstances",2);var ns=Object.defineProperty,as=Object.getOwnPropertyDescriptor,Le=(o,t,e,s)=>{for(var i=s>1?void 0:s?as(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&ns(t,e,i),i};class Ht extends u{constructor(){super(...arguments),this.applyOnStart=!0,this.randomMetallicRoughness=!0}start(){{const t=this.gameObject.getComponent(X);if(!t)return;for(let e=0;e<t.sharedMaterials.length;e++)t.sharedMaterials[e]=t.sharedMaterials[e].clone()}this.applyOnStart&&this.applyRandomColor()}applyRandomColor(){const t=this.gameObject.getComponent(X);if(!t){console.warn("Can not change color: No renderer on "+this.name);return}for(let e=0;e<t.sharedMaterials.length;e++){const s=t.sharedMaterials[e];s.color=new dt(Math.random(),Math.random(),Math.random()),this.randomMetallicRoughness&&s instanceof Wt&&(s.metalness=Math.random(),s.roughness=Math.random()*Math.random()),s.needsUpdate=!0,mi.markDirty(this.gameObject)}}}Le([p()],Ht.prototype,"applyOnStart",2);Le([p()],Ht.prototype,"randomMetallicRoughness",2);class ls extends u{constructor(){super(...arguments),this.renderer=null,this.collisionCount=0}start(){if(this.renderer=this.gameObject.getComponent(X),!!this.renderer){this._startColor||(this._startColor=[]);for(let t=0;t<this.renderer.sharedMaterials.length;t++)this.renderer.sharedMaterials[t]=this.renderer.sharedMaterials[t].clone(),this._startColor[t]=this.renderer.sharedMaterials[t].color.clone()}}onCollisionEnter(t){if(this.renderer){this.collisionCount+=1;for(let e=0;e<this.renderer.sharedMaterials.length;e++)this.renderer.sharedMaterials[e].color.setRGB(Math.random(),Math.random(),Math.random())}}onCollisionExit(t){if(!(!this.renderer||!this._startColor)&&(this.collisionCount-=1,this.collisionCount===0))for(let e=0;e<this.renderer.sharedMaterials.length;e++)this.renderer.sharedMaterials[e].color.copy(this._startColor[e])}}var hs=Object.defineProperty,cs=Object.getOwnPropertyDescriptor,ps=(o,t,e,s)=>{for(var i=s>1?void 0:s?cs(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&hs(t,e,i),i};class Fe extends u{update(){this.myMaterial&&(this.myMaterial._Speed*=1+this.context.time.deltaTime,this.myMaterial._Speed>1&&(this.myMaterial._Speed=5e-4),this.context.time.frame%30===0&&console.log(this.myMaterial._Speed))}}ps([a(je)],Fe.prototype,"myMaterial",2);var us=Object.defineProperty,ms=Object.getOwnPropertyDescriptor,We=(o,t,e,s)=>{for(var i=s>1?void 0:s?ms(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&us(t,e,i),i};class Qt extends u{constructor(){super(...arguments),this.tempVec1=new M,this.tempVec2=new M}update(){if(!this.lodGroup||!this.text)return;const t=this.context.mainCamera;t.getWorldPosition(this.tempVec1),this.gameObject.getWorldPosition(this.tempVec2);const e=this.tempVec1.distanceTo(this.tempVec2)/t.zoom,s=this.lodGroup._lodsHandler;let i=null;s==null||s.forEach(r=>{var g,x;const n=r.levels[r.getCurrentLevel()],h=r.levels.at(r.getCurrentLevel()+1);let d=null;if(n.object instanceof Te){const m=n.object.geometry.attributes,R=Math.floor(((g=m.position)==null?void 0:g.count)||0);d=`Triangles: ${Math.floor((((x=m.index)==null?void 0:x.count)||R)/3)}, Vertices: ${R}`}n.object.name.replace(/_/g,""),n.object.name.includes("Cull")||(i="",d&&(i+=`${d}
`),h==null||h.hysteresis,i+=`${n.distance.toFixed(1)} / ${e.toFixed(1)}`,h&&(i+=` / ${(h.distance-h.distance*h.hysteresis).toFixed(1)}`))}),i||(i="culled"),this.text.text=i}}We([a(di)],Qt.prototype,"lodGroup",2);We([a(gt)],Qt.prototype,"text",2);var ds=Object.defineProperty,fs=Object.getOwnPropertyDescriptor,Zt=(o,t,e,s)=>{for(var i=s>1?void 0:s?fs(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&ds(t,e,i),i};class wt extends u{constructor(){super(...arguments),this.apertureMultiplier=2,this.focalLength=.001,this.focusDistanceCutoff=25,this.volume=null,this.dofEffect=void 0}onEnable(){var t,e,s;this.volume=w.findObjectOfType(fi),this.dofEffect=(s=(e=(t=this.volume)==null?void 0:t.sharedProfile)==null?void 0:e.components)==null?void 0:s.find(i=>i.typeName==="DepthOfField"),this.orbit=w.findObjectOfType(we)}onBeforeRender(){var e;if(!((e=this.orbit)!=null&&e.controls))return;const t=this.orbit.controls.target.distanceTo(Et(this.orbit.gameObject));if(this.dofEffect){this.dofEffect.focusDistance.value=t,this.dofEffect.focalLength.value=this.focalLength;let s=y.inverseLerp(0,this.focusDistanceCutoff,t);s=y.clamp01(s),this.dofEffect.aperture.value=y.lerp(this.apertureMultiplier,32,s);const i=this.focusDistanceCutoff;t>i&&this.dofEffect.active?this.dofEffect.active=!1:t<i&&!this.dofEffect.active&&(this.dofEffect.active=!0)}}}Zt([a()],wt.prototype,"apertureMultiplier",2);Zt([a()],wt.prototype,"focalLength",2);Zt([a()],wt.prototype,"focusDistanceCutoff",2);class gs extends u{constructor(){super(...arguments),this._previousEnvironmentTexture=null}onEnable(){this._previousEnvironmentTexture=this.context.scene.environment,this.context.scene.environment=null}onDisable(){this.context.scene.environment=this._previousEnvironmentTexture}}var vs=Object.defineProperty,ys=Object.getOwnPropertyDescriptor,xs=(o,t,e,s)=>{for(var i=s>1?void 0:s?ys(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&vs(t,e,i),i};const ws=H("sample_debugParticlesOnClick");class Ve extends u{constructor(){super(...arguments),this.particleSystems=[]}update(){if(!this.context.isInVR&&this.context.input.getPointerClicked(0)){const t=this.context.physics.raycast();t.length>0&&this.spawnParticlesAt(t[0].point)}}onUpdateXR(t){t.xr.controllers.forEach(e=>{var s,i;if(((s=e.getButton("primary"))==null?void 0:s.isDown)===!0){const r=(i=this.context.physics.raycastFromRay(e.ray))==null?void 0:i.at(0);r&&this.spawnParticlesAt(r.point)}})}spawnParticlesAt(t){pt(this.gameObject,t),ws&&be.DrawWireSphere(t,.5,16711680,1);for(const e of this.particleSystems)e&&(w.setActive(e.gameObject,!0),e.play())}}xs([p(Pe)],Ve.prototype,"particleSystems",2);var _s=Object.defineProperty,bs=Object.getOwnPropertyDescriptor,Ps=(o,t,e,s)=>{for(var i=s>1?void 0:s?bs(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&_s(t,e,i),i};class Ne extends u{constructor(){super(...arguments),this.parameters=[]}awake(){var t=!1;this.parameters.forEach(e=>{H(e)||(gi(e,""),t=!0)}),t&&window.location.reload()}}Ps([a()],Ne.prototype,"parameters",2);var Os=Object.defineProperty,Ss=Object.getOwnPropertyDescriptor,qe=(o,t,e,s)=>{for(var i=s>1?void 0:s?Ss(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&Os(t,e,i),i};class Xt extends u{constructor(){super(...arguments),this.htmlSelector="button.some-button",this.onClick=new P,this.onClicked=()=>{this.onClick.invoke()}}onEnable(){this.element=document.querySelector(this.htmlSelector),this.element?this.element.addEventListener("click",this.onClicked):console.warn(`Could not find element with selector "${this.htmlSelector}"`)}onDisable(){this.element&&this.element.removeEventListener("click",this.onClicked)}}qe([p()],Xt.prototype,"htmlSelector",2);qe([a(P)],Xt.prototype,"onClick",2);var Cs=Object.defineProperty,Ms=Object.getOwnPropertyDescriptor,Ge=(o,t,e,s)=>{for(var i=s>1?void 0:s?Ms(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&Cs(t,e,i),i};const He=class extends u{onEnable(){var o;if(!(!this.methods||!this.names)){console.log("HTMLMenu.onEnable"),this.wrapper=document.createElement("ul"),this.wrapper.classList.add("needle-menu");for(let t=0;t<this.methods.length;t++){const e=this.methods[t];let s="Button";t<((o=this.names)==null?void 0:o.length)&&(s=this.names[t]);const i=document.createElement("li"),r=document.createElement("button");r.innerHTML=s,r.onclick=()=>{e.invoke()},i.appendChild(r),this.wrapper.appendChild(i)}this.styleElement=document.createElement("style"),this.styleElement.innerHTML=He.style,document.head.appendChild(this.styleElement),this.context.domElement.appendChild(this.wrapper)}}onDisable(){this.wrapper&&(this.wrapper.remove(),this.wrapper=void 0),this.styleElement&&(this.styleElement.remove(),this.styleElement=void 0)}};let _t=He;_t.style=`
        .needle-menu {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 100;
            list-style-type: none;
            margin: 0;
            overflow: hidden;
            background-color: white;
            display: flex;
            padding: 5px;
            border-radius: 20px;
        }

        .needle-menu li button {
            padding: 5px;
            margin: 0 5px;
            background: none;
            outline: none;
            border: 0;
            cursor: pointer;
        }

        .needle-menu li button:hover {
            font-weight: bold;
        }
    `;Ge([a(P)],_t.prototype,"methods",2);Ge([a()],_t.prototype,"names",2);const ve=new M,Ds=new D,ye=new M;class Ts extends V{constructor(t=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof Element&&e.element.parentNode!==null&&e.element.parentNode.removeChild(e.element)})})}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this}}const W=new it,Rs=new it;class js{constructor(t={}){const e=this;let s,i,r,n;const h={camera:{style:""},objects:new WeakMap},d=t.element!==void 0?t.element:document.createElement("div");d.style.overflow="hidden",this.domElement=d;const g=document.createElement("div");g.style.transformOrigin="0 0",g.style.pointerEvents="none",d.appendChild(g);const x=document.createElement("div");x.style.transformStyle="preserve-3d",g.appendChild(x),this.getSize=function(){return{width:s,height:i}},this.render=function(f,l){const $=l.projectionMatrix.elements[5]*n;l.view&&l.view.enabled?(g.style.transform=`translate( ${-l.view.offsetX*(s/l.view.width)}px, ${-l.view.offsetY*(i/l.view.height)}px )`,g.style.transform+=`scale( ${l.view.fullWidth/l.view.width}, ${l.view.fullHeight/l.view.height} )`):g.style.transform="",f.matrixWorldAutoUpdate===!0&&f.updateMatrixWorld(),l.parent===null&&l.matrixWorldAutoUpdate===!0&&l.updateMatrixWorld();let J,L;l.isOrthographicCamera&&(J=-(l.right+l.left)/2,L=(l.top+l.bottom)/2);const F=l.view&&l.view.enabled?l.view.height/l.view.fullHeight:1,k=l.isOrthographicCamera?`scale( ${F} )scale(`+$+")translate("+m(J)+"px,"+m(L)+"px)"+R(l.matrixWorldInverse):`scale( ${F} )translateZ(`+$+"px)"+R(l.matrixWorldInverse),tt=(l.isPerspectiveCamera?"perspective("+$+"px) ":"")+k+"translate("+r+"px,"+n+"px)";h.camera.style!==tt&&(x.style.transform=tt,h.camera.style=tt),G(f,f,l)},this.setSize=function(f,l){s=f,i=l,r=s/2,n=i/2,d.style.width=f+"px",d.style.height=l+"px",g.style.width=f+"px",g.style.height=l+"px",x.style.width=f+"px",x.style.height=l+"px"};function m(f){return Math.abs(f)<1e-10?0:f}function R(f){const l=f.elements;return"matrix3d("+m(l[0])+","+m(-l[1])+","+m(l[2])+","+m(l[3])+","+m(l[4])+","+m(-l[5])+","+m(l[6])+","+m(l[7])+","+m(l[8])+","+m(-l[9])+","+m(l[10])+","+m(l[11])+","+m(l[12])+","+m(-l[13])+","+m(l[14])+","+m(l[15])+")"}function j(f){const l=f.elements;return"translate(-50%,-50%)"+("matrix3d("+m(l[0])+","+m(l[1])+","+m(l[2])+","+m(l[3])+","+m(-l[4])+","+m(-l[5])+","+m(-l[6])+","+m(-l[7])+","+m(l[8])+","+m(l[9])+","+m(l[10])+","+m(l[11])+","+m(l[12])+","+m(l[13])+","+m(l[14])+","+m(l[15])+")")}function G(f,l,$,J){if(f.isCSS3DObject){const L=f.visible===!0&&f.layers.test($.layers)===!0;if(f.element.style.display=L===!0?"":"none",L===!0){f.onBeforeRender(e,l,$);let F;f.isCSS3DSprite?(W.copy($.matrixWorldInverse),W.transpose(),f.rotation2D!==0&&W.multiply(Rs.makeRotationZ(f.rotation2D)),f.matrixWorld.decompose(ve,Ds,ye),W.setPosition(ve),W.scale(ye),W.elements[3]=0,W.elements[7]=0,W.elements[11]=0,W.elements[15]=1,F=j(W)):F=j(f.matrixWorld);const k=f.element,Ct=h.objects.get(f);if(Ct===void 0||Ct.style!==F){k.style.transform=F;const tt={style:F};h.objects.set(f,tt)}k.parentNode!==x&&x.appendChild(k),f.onAfterRender(e,l,$)}}for(let L=0,F=f.children.length;L<F;L++)G(f.children[L],l,$)}}}var Es=Object.defineProperty,As=Object.getOwnPropertyDescriptor,bt=(o,t,e,s)=>{for(var i=s>1?void 0:s?As(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&Es(t,e,i),i};class ot extends u{constructor(){super(...arguments),this.url="https://www.youtube.com/embed/puWNRrG4MCg",this.pixelsPerUnit=500,this.borderRadius=50,this.animator=null,this.rotate90=new D().setFromAxisAngle(new M(0,1,0),Math.PI)}start(){const t=H("url");t&&(this.url=t);const e=document.createElement("div");e.innerHTML='<iframe width="1000" height="1000" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; xr-spatial-tracking; xr" allowfullscreen></iframe>',e.style.zIndex="10000",e.style.position="absolute",e.style.pointerEvents="initial";const s=e.querySelector("iframe");s.addEventListener("load",()=>{setTimeout(()=>{var d;console.log("Automatically opening iframe"),(d=this.animator)==null||d.SetBool("Open",!0)},1e3)}),s.src=this.url;let i=1e3;const r=Math.round(this.gameObject.scale.x*this.pixelsPerUnit),n=Math.round(this.gameObject.scale.y*this.pixelsPerUnit);i=Math.max(r,n),s.width=r+"px",s.height=n+"px",e.style.position="absolute",this.borderRadius>0&&(e.style.borderRadius=this.borderRadius+"px"),e.style.pointerEvents="initial",document.body.append(e),this.cssRenderer=new js,this.cssRenderer.domElement.style.pointerEvents="none",this.cssRenderer.domElement.style.position="absolute",this.cssRenderer.domElement.style.top="0px",document.body.append(this.cssRenderer.domElement),this.cssScene=new De;const h=new Ts(e);h.scale.setScalar(Math.max(this.gameObject.scale.x,this.gameObject.scale.y)/i),pt(h,Et(this.gameObject)),se(h,re(this.gameObject)),h.quaternion.multiply(this.rotate90),this.cssScene.add(h),this.cssObj=h,this.context.post_render_callbacks.push(this.onPostRender.bind(this))}onPostRender(){if(!this.cssObj||!this.cssRenderer||!this.cssScene)return;pt(this.cssObj,Et(this.gameObject)),se(this.cssObj,re(this.gameObject)),this.cssObj.quaternion.multiply(this.rotate90);const t=this.context.mainCamera,e=this.gameObject;var s=t.position.clone().sub(this.gameObject.position).normalize(),i=e.getWorldDirection(new M);const r=s.dot(i);this.cssObj.visible=r<.15;const n=this.cssRenderer.getSize();(n.width!==this.context.domWidth||n.height!==this.context.domHeight)&&this.cssRenderer.setSize(this.context.domWidth,this.context.domHeight),this.cssRenderer.render(this.cssScene,this.context.mainCamera)}}bt([p()],ot.prototype,"url",2);bt([p()],ot.prototype,"pixelsPerUnit",2);bt([p()],ot.prototype,"borderRadius",2);bt([p(Oe)],ot.prototype,"animator",2);class Bs extends u{constructor(){super(...arguments),this._ui=null}awake(){const t=w.findObjectsOfType(vi),e=document.createElement("div");e.style.cssText=`
            position: absolute;
            top: 1em;
            left: 1em;
            line-height: 1.5em;
            display: block;
            width: 200px;
        `,this.context.domElement.appendChild(e),this._ui=e;const s=document.createElement("h2");s.style.cssText=`
            margin-bottom: .7em;
        `,s.innerText="Sample Images",e.appendChild(s);const i=document.createElement("p");i.innerHTML=`Download the image and print it or you can also open the image in your browser
        <br><strong>Then enter AR and scan it with your camera.</strong>
        <br>Visit our <a target="_blank" href="https://docs.needle.tools/image-tracking">ImageTracking documentation</a> for more information.
        `,i.style.userSelect="all",e.appendChild(i);for(const r of t)this.createDownloadImageUI(r,e)}update(){var t;this.context.isInAR?(t=this._ui)==null||t.remove():this._ui&&!this._ui.parentNode&&this.context.domElement.appendChild(this._ui)}createDownloadImageUI(t,e){if(t.trackedImages)for(const s of t.trackedImages){if(!s.image)continue;const i=document.createElement("a");i.href=s.image,e.appendChild(i);const r=document.createElement("img");r.src=s.image,r.style.cssText=`
                min-width: 180px;
                max-width: 220px;
                width: 15vw;
                height: auto;
                aspect-ratio: 1.3;
                object-fit: cover;
                background: rgba(0,0,0,0.5);
                border-radius: 10px;
                border: 2px solid rgba(255,255,255,1);
                box-shadow: 0 0 10px rgba(0,0,0,.2);
                margin-left: -.5em;
            `,i.appendChild(r)}}}var Is=Object.defineProperty,$s=Object.getOwnPropertyDescriptor,Pt=(o,t,e,s)=>{for(var i=s>1?void 0:s?$s(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&Is(t,e,i),i};class Bt extends u{onColorChanged(){typeof this.color=="number"&&(this.color=new dt(this.color)),this.setColorToMaterials()}onPointerClick(t){const e=new dt(Math.random(),Math.random(),Math.random());this.color=e}onEnable(){this.setColorToMaterials()}setColorToMaterials(){var e;const t=this.gameObject.getComponent(X);if(t)for(let s=0;s<t.sharedMaterials.length;s++){const i=(e=t.sharedMaterials[s])==null?void 0:e.clone();t.sharedMaterials[s]=i,i&&"color"in i&&(i.color=this.color)}else console.warn("No renderer found",this.gameObject)}}Pt([st(Bt.prototype.onColorChanged),a(dt)],Bt.prototype,"color",2);class It extends u{constructor(){super(...arguments),this.myArray=[],this.updateArray=()=>{const t=new Date().toLocaleTimeString();console.log("> Update array",t),this.myArray.length>10&&(console.log("Clearing array because we have reached 10 entries"),this.myArray.length=0),this.myArray.push(t),this.myArray=this.myArray,U('<strong>> Sent</strong> "'+t+'", we now have '+this.myArray.length+" elements")}}awake(){U("Open this window in another browser tab/window to see the networking in action..."),this.context.connection.beginListen(Lt.JoinedRoom,async()=>{console.log("Will append a new value every 10 seconds"),setInterval(this.updateArray,1e4),await et(100),this.updateArray()})}onArrayChanged(){console.log("< Received array",this.myArray[this.myArray.length-1],this.myArray),U('<strong>< Received</strong> "'+this.myArray[this.myArray.length-1]+'", we now have '+this.myArray.length+" elements")}}Pt([st(It.prototype.onArrayChanged)],It.prototype,"myArray",2);class Us{constructor(){this.name="",this.age=0}}class ft extends u{constructor(){super(...arguments),this.myObject=new Us,this._mockAge=0,this.updateObject=()=>{this.myObject.name=this.context.connection.connectionId,this._mockAge+=1,this.myObject.age=this._mockAge,this.myObject=this.myObject,console.log("> Updated",this.myObject),U('<strong>> Sent</strong> "'+this.myObject.name+'" is '+this.myObject.age+" years old")}}awake(){U("Open this window in another browser tab/window to see the networking in action..."),this.context.connection.beginListen(Lt.JoinedRoom,async()=>{await et(1),this.updateObject()})}onObjectChanged(){console.log("< Received object",this.myObject),U('<strong>< Received</strong> "'+this.myObject.name+'" is '+this.myObject.age+" years old")}}Pt([st(ft.prototype.onObjectChanged)],ft.prototype,"myObject",2);Pt([st()],ft.prototype,"_mockAge",2);var zs=Object.defineProperty,Ls=Object.getOwnPropertyDescriptor,Qe=(o,t,e,s)=>{for(var i=s>1?void 0:s?Ls(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&zs(t,e,i),i};class Yt extends u{constructor(){super(...arguments),this.clampFrameRate=!0,this._clampFrameRate=!1,this.maxFrameRate=72,this._maxFrameRate=-1024}update(){if(this._clampFrameRate!==this.clampFrameRate||this._maxFrameRate!==this.maxFrameRate){const t=this.clampFrameRate?this.maxFrameRate:void 0;this.context.targetFrameRate=t,this._clampFrameRate=this.clampFrameRate,this._maxFrameRate=this.maxFrameRate}}setTarget(t){this.maxFrameRate=t,this.clampFrameRate=!0}setClamping(t){this.clampFrameRate=t}}Qe([a()],Yt.prototype,"clampFrameRate",2);Qe([a()],Yt.prototype,"maxFrameRate",2);var Fs=Object.defineProperty,Ws=Object.getOwnPropertyDescriptor,q=(o,t,e,s)=>{for(var i=s>1?void 0:s?Ws(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&Fs(t,e,i),i};class nt extends u{constructor(){super(...arguments),this.logEvents=!1}onCollisionEnter(t){var e;this.logEvents&&console.log("ENTER",t),(e=this.onEnter)==null||e.invoke(t)}onCollisionStay(t){var e;this.logEvents&&console.log("STAY",t),(e=this.onStay)==null||e.invoke(t)}onCollisionExit(t){var e;this.logEvents&&console.log("EXIT",t),(e=this.onExit)==null||e.invoke(t)}}q([p(P)],nt.prototype,"onEnter",2);q([p(P)],nt.prototype,"onStay",2);q([p(P)],nt.prototype,"onExit",2);q([p()],nt.prototype,"logEvents",2);class at extends u{onTriggerEnter(t){var e,s;this.triggerObjects&&this.triggerObjects.length>0&&!((e=this.triggerObjects)!=null&&e.includes(t.gameObject))||(s=this.onEnter)==null||s.invoke()}onTriggerStay(t){var e,s;this.triggerObjects&&this.triggerObjects.length>0&&!((e=this.triggerObjects)!=null&&e.includes(t.gameObject))||(s=this.onStay)==null||s.invoke()}onTriggerExit(t){var e,s;this.triggerObjects&&this.triggerObjects.length>0&&!((e=this.triggerObjects)!=null&&e.includes(t.gameObject))||(s=this.onExit)==null||s.invoke()}}q([p(w)],at.prototype,"triggerObjects",2);q([p(P)],at.prototype,"onEnter",2);q([p(P)],at.prototype,"onStay",2);q([p(P)],at.prototype,"onExit",2);var Vs=Object.defineProperty,Ns=Object.getOwnPropertyDescriptor,qs=(o,t,e,s)=>{for(var i=s>1?void 0:s?Ns(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&Vs(t,e,i),i};class Ze extends u{constructor(){super(...arguments),this._lastTriggerTime=0}onTriggerEnter(t){this.context.time.time-this._lastTriggerTime<.3||(this._lastTriggerTime=this.context.time.time,this.animation&&this.animation.play(0,{loop:!1}))}onTriggerExit(){}}qs([p(Ft)],Ze.prototype,"animation",2);var Gs=Object.defineProperty,Hs=Object.getOwnPropertyDescriptor,Qs=(o,t,e,s)=>{for(var i=s>1?void 0:s?Hs(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&Gs(t,e,i),i};class Xe extends u{onTriggerEnter(){var t,e;(t=this.animation)!=null&&t.isPlaying||(e=this.animation)==null||e.play(0,{loop:!1})}}Qs([p(Ft)],Xe.prototype,"animation",2);var Zs=Object.defineProperty,Xs=Object.getOwnPropertyDescriptor,Ys=(o,t,e,s)=>{for(var i=s>1?void 0:s?Xs(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&Zs(t,e,i),i};class Ye extends u{onCollisionEnter(){var t,e;(t=this.audioSource)==null||t.stop(),(e=this.audioSource)==null||e.play()}}Ys([p(zt)],Ye.prototype,"audioSource",2);var Ks=Object.defineProperty,Js=Object.getOwnPropertyDescriptor,Ke=(o,t,e,s)=>{for(var i=s>1?void 0:s?Js(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&Ks(t,e,i),i};class Kt extends u{constructor(){super(...arguments),this.referenceSize=512,this.updateSize=()=>{if(this.content){if(this.referenceSize<=0)return console.error("ResponsiveContent: Base width must be greater than 0.");const t=this.context.domWidth/this.referenceSize;this.content.scale.set(t,t,t)}else ut()&&console.warn("ResponsiveContent: No content object set.")}}onEnable(){window.addEventListener("resize",this.updateSize),this.updateSize()}onDisable(){window.removeEventListener("resize",this.updateSize)}}Ke([a(V)],Kt.prototype,"content",2);Ke([a()],Kt.prototype,"referenceSize",2);var ks=Object.defineProperty,tr=Object.getOwnPropertyDescriptor,Jt=(o,t,e,s)=>{for(var i=s>1?void 0:s?tr(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&ks(t,e,i),i};class Je extends u{async sceneOpened(){var t;(t=this.animator)==null||t.setBool("SceneOpen",!0),this._htmlElement=this._getHtmlElement(),this.context.domElement.appendChild(this._htmlElement)}async sceneClosing(){var t,e;await et(1e3),(t=this.animator)==null||t.setBool("SceneOpen",!1),await et(1e3),(e=this._htmlElement)==null||e.remove()}_getHtmlElement(){if(!this._htmlElement){this._htmlElement=document.createElement("div"),this._htmlElement.style.cssText=`
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                // backdrop-filter: blur(10px);
            `;const t=document.createElement("img");t.src="https://engine.needle.tools/branding/needle-logo.png",this._htmlElement.appendChild(t)}return this._htmlElement}}Jt([a(Oe)],Je.prototype,"animator",2);class kt extends u{sceneOpened(){var t;return ut()&&console.log("Scene opened",this.name),(t=this.opened)==null||t.invoke(),Promise.resolve()}sceneClosing(){var t;return ut()&&console.log("Scene closing",this.name),(t=this.closing)==null||t.invoke(),Promise.resolve()}}Jt([a(P)],kt.prototype,"opened",2);Jt([a(P)],kt.prototype,"closing",2);class er extends u{next(){var t;this.switcher??(this.switcher=this.get()),console.log(this.switcher),(t=this.switcher)==null||t.selectNext()}previous(){var t;this.switcher??(this.switcher=this.get()),(t=this.switcher)==null||t.selectPrev()}get(){return w.findObjectOfType(yi)}}var ir=Object.defineProperty,sr=Object.getOwnPropertyDescriptor,rr=(o,t,e,s)=>{for(var i=s>1?void 0:s?sr(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&ir(t,e,i),i};class ke extends u{constructor(){super(...arguments),this.text=""}start(){U(this.text)}}rr([a()],ke.prototype,"text",2);var or=Object.defineProperty,nr=Object.getOwnPropertyDescriptor,ar=(o,t,e,s)=>{for(var i=s>1?void 0:s?nr(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&or(t,e,i),i};const lr=H("testleaderboard");class $t extends u{constructor(){super(...arguments),this._ready=!1}get ready(){return this._ready}onEnable(){this.context.connection.beginListen(Lt.JoinedRoom,async()=>{await et(100),this.context.connection.tryGetState(this.guid)||(this.data={scores:[]}),this._ready=!0}),lr?(console.log("Enabled test leaderboard, adding random scores"),setInterval(()=>{this.insertScore("Player",Math.floor(Math.random()*1e3))},2e3)):ut()&&U("You can add ?testleaderboard to the url to test the leaderboard")}insertScore(t,e){if(!this._ready){console.warn("Cannot insert score, data not received yet");return}const s=10,i=this.data.scores;for(;i.length>=s;){this.sortScores();const r=i.pop();if(r.score>e){console.log(`Score ${e} is lower than ${r==null?void 0:r.score} (lowest score), ignoring`),i.push(r);return}}console.log("Inserting score",t,e),i.push({name:t,score:e}),this.sortScores(),this.data=this.data}sortScores(){this.data.scores.sort((t,e)=>e.score-t.score)}onDataChanged(t){if(console.warn("Data changed!",t,this.data.scores),this.data.scores.length>0){const e=this.data.scores[0];U("HIGHSCORE - "+e.name+": "+e.score)}this.dispatchEvent(new CustomEvent("changed",{detail:this.data}))}}ar([st($t.prototype.onDataChanged)],$t.prototype,"data",2);var hr=Object.defineProperty,cr=Object.getOwnPropertyDescriptor,pr=(o,t,e,s)=>{for(var i=s>1?void 0:s?cr(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&hr(t,e,i),i};class ti extends u{start(){this.updateStartPosition()}updateStartPosition(){this.startPosition=this.gameObject.position.clone()}resetToStart(){if(!this.startPosition)return;const t=w.getComponent(this.gameObject,N);t==null||t.teleport(this.startPosition)}}class ei extends ti{start(){super.start(),this.worldCollider||console.warn("Missing collider to reset",this)}onTriggerExit(t){t===this.worldCollider&&this.resetToStart()}}pr([p(vt)],ei.prototype,"worldCollider",2);var ur=Object.defineProperty,mr=Object.getOwnPropertyDescriptor,dr=(o,t,e,s)=>{for(var i=s>1?void 0:s?mr(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&ur(t,e,i),i};class ii extends u{constructor(){super(...arguments),this.roomId="",this.playerCount=0}update(){const t=this.context.connection;let e=!1;t.currentRoomName&&t.currentRoomName!==this.roomId&&(this.roomId=t.currentRoomName,e=!0),t.usersInRoom().length!==this.playerCount&&(this.playerCount=t.usersInRoom().length,e=!0),e&&this.connectionLabel&&(this.connectionLabel.text=`Room: ${this.roomId}
Users: ${this.playerCount}
Your id: ${t.connectionId}`)}}dr([a(gt)],ii.prototype,"connectionLabel",2);var fr=Object.defineProperty,gr=Object.getOwnPropertyDescriptor,vr=(o,t,e,s)=>{for(var i=s>1?void 0:s?gr(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&fr(t,e,i),i};class si extends u{constructor(){super(...arguments),this.interval=1e3,this.max=100,this.spawned=0}awake(){if(!this.object){console.warn("TimedSpawn: no object to spawn"),U("TimedSpawn: no object to spawn",xi.Warn);return}w.setActive(this.object,!1),this.startCoroutine(this.spawn())}*spawn(){if(this.object)for(;this.spawned<this.max;){const t=w.instantiate(this.object);w.setActive(t,!0),this.spawned+=1,yield wi(this.interval/1e3)}}}vr([p(w)],si.prototype,"object",2);class yr extends u{async awake(){const t=document.createElement("video");t.style.cssText=`
            position: fixed;
            min-width: 100%;
            min-height: 100%;
            z-index: -1;
        `,this.context.domElement.shadowRoot.appendChild(t);const e=await navigator.mediaDevices.getUserMedia({video:!0});if(!e)return;t.srcObject=e,t.play();const s=this.context.mainCameraComponent;s&&(s.clearFlags=_i.SolidColor,s.backgroundColor=new bi(125,125,125,0))}}var xr=Object.defineProperty,wr=Object.getOwnPropertyDescriptor,Ot=(o,t,e,s)=>{for(var i=s>1?void 0:s?wr(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&xr(t,e,i),i};class lt extends u{constructor(){super(...arguments),this.interval=3,this.resetPosition=!0,this.resetRotation=!1,this.resetVelocity=!1}start(){const t=this.gameObject.position.clone(),e=this.gameObject.rotation.clone(),s=this.gameObject.getComponent(N),i=this.context.time.frame;setInterval(()=>{this.resetPosition&&this.gameObject.position.copy(t),this.resetRotation&&this.gameObject.rotation.copy(e),s&&this.resetVelocity&&this.context.time.frame!==i&&s.resetVelocities()},this.interval*1e3)}}Ot([a()],lt.prototype,"interval",2);Ot([a()],lt.prototype,"resetPosition",2);Ot([a()],lt.prototype,"resetRotation",2);Ot([a()],lt.prototype,"resetVelocity",2);class _r extends u{constructor(){super(...arguments),this.toggleRendererOnly=!1}start(){setInterval(()=>{if(U('This is a sample for showing how to <a href="https://engine.needle.tools/docs/scripting.html#component-architecture" target="_blank">toggle visibility of a GameObject</a>'),this.toggleRendererOnly){const t=this.gameObject.getComponent(X);t&&(t.enabled=!t.enabled)}else this.gameObject.visible=!this.gameObject.visible},1e3)}}var br=Object.defineProperty,Pr=Object.getOwnPropertyDescriptor,Or=(o,t,e,s)=>{for(var i=s>1?void 0:s?Pr(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&br(t,e,i),i};class ri extends u{awake(){this.material&&(this.material.wireframe=!0)}}Or([a(je)],ri.prototype,"material",2);var Sr=Object.defineProperty,Cr=Object.getOwnPropertyDescriptor,oi=(o,t,e,s)=>{for(var i=s>1?void 0:s?Cr(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&Sr(t,e,i),i};class te extends u{constructor(){super(...arguments),this.onSessionStart=new P,this.onSessionEnd=new P}onEnterXR(t){this.onWebXRStarted()}onExitXR(t){this.onWebXREnded()}onWebXRStarted(){oe(this.context.scene,!1),this.onSessionStart.invoke()}onWebXREnded(){oe(this.context.scene,!1),this.onSessionEnd.invoke()}}oi([a(P)],te.prototype,"onSessionStart",2);oi([a(P)],te.prototype,"onSessionEnd",2);class ni extends u{constructor(){super(...arguments),this.destroyTarget=!1,this._startTime=0}awake(){if(this._rigidbody=this.gameObject.getComponentInParent(N)||void 0,this._rigidbody){const t=this.gameObject.getComponentsInChildren(vt);for(const e of t){const s=w.addComponent(e.gameObject,Mr);s.rigidBody=this._rigidbody,s.arrow=this,s.destroyTarget=this.destroyTarget}}this._startTime=this.context.time.time}onBeforeRender(){if(this.context.time.time-this._startTime>5){this.gameObject.destroy();return}if(this._rigidbody){const t=this._rigidbody.getVelocity();if(t.lengthSq()>0){const e=v().set(t.x,t.y,t.z).normalize(),s=E();s.setFromUnitVectors(v(0,0,1),e),this.gameObject.quaternion.copy(s)}}}}class Mr extends u{constructor(){super(...arguments),this.destroyTarget=!1}onCollisionEnter(t){if(this.arrow)if(this.destroyTarget)t.gameObject.destroy(),this.arrow.gameObject.destroy();else{t.gameObject.attach(this.arrow.gameObject),t.rigidBody instanceof N&&t.rigidBody.applyImpulse(t.gameObject.position.clone().multiply(this.rigidBody.getVelocity()),!0);const e=this.rigidBody.gameObject.getComponentsInChildren(vt);for(const s of e)s.destroy();this.rigidBody.destroy(),this.arrow.destroy()}}}var Dr=Object.defineProperty,Tr=Object.getOwnPropertyDescriptor,T=(o,t,e,s)=>{for(var i=s>1?void 0:s?Tr(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&Dr(t,e,i),i};const Rr=H("debugarrow");class C extends u{constructor(){super(...arguments),this.power=1.5,this.drawMaxPhysicalDistance=.47269,this.drawMinPhysicalDistance=.1132593,this.desktopIdleDrawAmount=.25,this.interactionPixelOrigin=new b(.5,.65),this.interactionPixelTreshold=85,this.drawMaxPixelDistance=100,this._isAiming=!1,this._aimingPointerStartPos=new b(0,0),this._bowController=void 0,this._stringController=void 0,this.onDown=t=>{var e;if(t.origin instanceof ne){if(t.button===0){this._isAiming=!0,this._bowController===void 0?this._bowController=t.origin.index:this._stringController===void 0&&(this._stringController=t.origin.index);const s=(e=this.bowObject)==null?void 0:e.getComponentInParent(Si);s&&(s.side=this._bowController)}}else t.button===0&&(this.getPointerDinstanceTo(this._aimingPointerStartPos,t.pointerId),this._isAiming=!0,this._aimingPointerId=t.pointerId)},this.onRelease=t=>{var e;if(t.button===0&&this._isAiming){if(this._isAiming=!1,this._aimingPointerId=void 0,t.origin instanceof ne){const s=t.origin;if(s.index===this._stringController&&this._bowController!==void 0){const i=(e=_e.active)==null?void 0:e.getController(this._bowController);if(s&&i){const r=s.gripWorldPosition;if(r){const n=i.gripWorldPosition.clone().sub(r);let h=i.object.worldPosition.distanceTo(s.object.worldPosition);h-=this.drawMinPhysicalDistance;const d=y.clamp01(h/this.drawMaxPhysicalDistance);n.normalize().multiplyScalar(d*this.power),this.shoot(r,n),Rr&&be.DrawArrow(r,n.clone().add(r),16776960,1)}}}s.index===this._bowController&&(this._bowController=void 0),s.index===this._stringController&&(this._stringController=void 0)}else if(this.arrowSpawnSpot){const s=this.arrowSpawnSpot.getWorldPosition(v()),i=this.gameObject.getWorldDirection(v()),r=this.getPointerDinstanceTo(this._aimingPointerStartPos,t.pointerId),n=y.clamp01(r/this.drawMaxPixelDistance)*this.power;i.multiplyScalar(n),r>this.interactionPixelTreshold&&this.shoot(s,i)}}},this.shotStamp=Number.MIN_SAFE_INTEGER,this.fakeArrowRespawnDuration=.3,this._initRot=new D,this._tempLookMatrix=new it,this._tempLookRot=new D,this._rotate90=new D().setFromAxisAngle(new M(0,0,1),Math.PI/2),this.tempDir=new b,this.tempUpRef=new b}awake(){var t;(t=this.arrowPrefab)!=null&&t.asset&&(this.arrowPrefab.asset.visible=!1),this.bowObject&&this._initRot.copy(this.bowObject.quaternion),this.nonMountedParent=this.gameObject.parent,this.mount()}onEnable(){var t;(t=this.arrowPrefab)==null||t.loadAssetAsync(),this._isAiming=!1,this.context.input.addEventListener("pointerdown",this.onDown),this.context.input.addEventListener("pointerup",this.onRelease),this.setupPreDraw()}onDisable(){this._isAiming=!1,this.context.input.removeEventListener("pointerdown",this.onDown),this.context.input.removeEventListener("pointerup",this.onRelease)}getPointerDinstanceTo(t,e){const s=this.context.input.getPointerPosition(e);return t.distanceTo(s)}async setupPreDraw(){var e,s;if(!this.arrowPrefab||!this.arrowSpawnSpot||this.fakeArrow)return;const t=await this.arrowPrefab.instantiate({parent:this.arrowSpawnSpot});t&&(t.visible=!0,t.worldScale=v(1,1,1),this.fakeArrow=t,(e=t.getComponent(ni))==null||e.destroy(),(s=t.getComponent(N))==null||s.destroy(),t.getComponentsInChildren(vt).forEach(i=>i.destroy()))}async shoot(t,e){var g,x;if(!this.arrowPrefab)return;this.shotStamp=this.context.time.time;const s=t.clone(),i=s.clone().add(e),r=Math.pow(e.length()+.5,2),n=e.clone().normalize(),h=await this.arrowPrefab.instantiate({parent:this.context.scene});if(!h)return;h.worldPosition=s,h.lookAt(i),h.visible=!0;const d=h.getComponent(N);d&&(d.isKinematic=!1,d.autoMass=!1,d.mass=.05,(g=this.sound)==null||g.stop(),(x=this.sound)==null||x.play(),await Se(1),d.applyImpulse(n.multiplyScalar(r),!0))}mount(){this.cameraParent&&(this.gameObject.parent=this.cameraParent,this.gameObject.position.set(0,0,0),this.gameObject.quaternion.set(0,0,0,1))}unmount(){this.gameObject.parent=this.nonMountedParent}get _hasControllers(){var t;return(((t=this.context.xr)==null?void 0:t.controllers.length)??0)>0}onEnterXR(t){(t.xr.isVR||t.xr.isPassThrough)&&this.unmount()}onLeaveXR(t){this.mount()}onBeforeRender(){if(!this.animationComponent||!this.bowObject)return;if(!this._mixer){this._mixer=new zi(this.bowObject);const r=this.animationComponent.animations.at(0);r&&(this._animation=this._mixer.clipAction(r))}const t=.1;let e=0;if(this._hasControllers){if(!this._isAiming)e=0;else if(this.context.xr&&this.context.xr.controllers.length>1&&this._bowController!==void 0&&this._stringController!==void 0){const r=this.context.xr.controllers[this._stringController],n=this.context.xr.controllers[this._bowController];if(!r||!n)return;let h=v(0,1,0);!n.hand&&n.targetRayMode==="tracked-pointer"&&h.applyQuaternion(this._rotate90),h.applyQuaternion(n.gripWorldQuaternion).normalize(),this._tempLookMatrix.lookAt(r.gripWorldPosition,n.gripWorldPosition,h),this._tempLookRot.setFromRotationMatrix(this._tempLookMatrix),this.bowObject.worldQuaternion=this._tempLookRot;let d=r.object.worldPosition.distanceTo(n.object.worldPosition);d-=this.drawMinPhysicalDistance,e=y.clamp01(d/this.drawMaxPhysicalDistance)}}else{const r=this.interactionPixelOrigin;if(this._aimingPointerStartPos.set(this.context.domWidth*r.x,this.context.domHeight*r.y),!this._isAiming)e=this.desktopIdleDrawAmount;else{const n=this.context.input;if(this._aimingPointerId!=null){const h=this._aimingPointerStartPos,d=n.getPointerPosition(this._aimingPointerId),g=this.tempDir.copy(d).sub(h),m=g.length(),R=v();R.x=g.x,R.z=g.y,R.normalize();const j=this.gameObject.getWorldDirection(v());j.y=0,j.normalize();const G=R.dot(j),f=m>this.interactionPixelTreshold;(G>0||f)&&(e=y.clamp01(m/this.drawMaxPixelDistance)),this.tempUpRef.set(1,0);const $=this.tempUpRef.dot(g)>0?-1:1;this.tempUpRef.set(0,1);const J=this.tempUpRef.angleTo(g)*$;if(f){const L=E().setFromAxisAngle(v().set(1,0,0),J);this.gameObject.quaternion.slerp(L,this.context.time.deltaTime/.05)}}}}this.drawProgression&&(e=this.drawProgression.evaluate(e)),this._animation.timeScale=0;const s=y.lerp(this._animation.time,e,this.context.time.deltaTime/t),i=this._animation.time;if(this._animation.time=s,Math.abs(s-i)>Number.EPSILON&&(this._animation.setEffectiveWeight(1),this._animation.play()),this._mixer.update(this.context.time.deltaTime),this.fakeArrow){let r=(this.context.time.time-this.shotStamp)/this.fakeArrowRespawnDuration;r=this.easeInOutSine(y.clamp01(r)),this.fakeArrow.worldScale=v(1,1,1).multiplyScalar(r)}}easeInOutSine(t){return y.clamp01(-.5*(Math.cos(Math.PI*t)-1))}}T([a()],C.prototype,"power",2);T([a()],C.prototype,"drawMaxPhysicalDistance",2);T([a()],C.prototype,"drawMinPhysicalDistance",2);T([a(Pi)],C.prototype,"drawProgression",2);T([a(V)],C.prototype,"cameraParent",2);T([a()],C.prototype,"desktopIdleDrawAmount",2);T([a(b)],C.prototype,"interactionPixelOrigin",2);T([a()],C.prototype,"interactionPixelTreshold",2);T([a()],C.prototype,"drawMaxPixelDistance",2);T([a(V)],C.prototype,"bowObject",2);T([a(Ft)],C.prototype,"animationComponent",2);T([a(Oi)],C.prototype,"arrowPrefab",2);T([a(V)],C.prototype,"arrowSpawnSpot",2);T([a(zt)],C.prototype,"sound",2);T([a()],C.prototype,"fakeArrowRespawnDuration",2);var jr=Object.defineProperty,Er=Object.getOwnPropertyDescriptor,Ar=(o,t,e,s)=>{for(var i=s>1?void 0:s?Er(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&jr(t,e,i),i};class ai extends u{start(){this._meshRenderer=this.gameObject.getComponentInChildren(Ci)}onDestroy(){if(this.particleSystem){if(this.particleSystem.shape.shapeType===Mt.MeshRenderer&&this._meshRenderer&&!Ce(this._meshRenderer.gameObject)){this.particleSystem.shape.shapeType=Mt.MeshRenderer,this.particleSystem.shape.setMesh(this._meshRenderer),this.particleSystem.play();return}this.particleSystem.shape.shapeType=Mt.Sphere,this.particleSystem.worldPosition=this.gameObject.worldPosition,this.particleSystem.play()}}}Ar([a(Pe)],ai.prototype,"particleSystem",2);var Br=Object.defineProperty,Ir=Object.getOwnPropertyDescriptor,$r=(o,t,e,s)=>{for(var i=s>1?void 0:s?Ir(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&Br(t,e,i),i};class li extends u{constructor(){super(...arguments),this._instances=new Array}awake(){var t,e;if(!((t=this.prefabs)!=null&&t.length)||((e=this.prefabs)==null?void 0:e.length)===0){console.warn("BowTargetSpawner start: no prefab set"),this.enabled=!1;return}this.prefabs.forEach(s=>s.visible=!1)}update(){var e;if(!((e=this.prefabs)!=null&&e.length))return;const t=v();for(let s=this._instances.length-1;s>=0;s--){const i=this._instances[s];Ce(i.instance)?this._instances.splice(s,1):(t.setScalar(i.scale),i.instance.scale.lerp(t,this.context.time.deltaTime))}if(this.context.time.frame%20===0&&Math.random()>.5){const s=this.worldPosition;s.x+=Math.random()*12-6,s.y+=Math.random()*3,s.z+=Math.random()*6;const i=Math.random()*3+.5,r=this.prefabs[Math.floor(Math.random()*this.prefabs.length)],n=Mi(r,{parent:this.scene,position:s.clone(),scale:new M(.01,.01,.01),keepWorldPosition:!0});n.visible=!0,this._instances.push({instance:n,scale:i}),setTimeout(()=>{n.destroy()},7e3),Se(1).then(()=>{const h=n.getComponentInChildren(N);h&&(h.gravityScale=.2+Math.random()*.3,h.mass=2,h.autoMass=!1),h==null||h.setAngularVelocity(y.random(-2,2),y.random(-2,2),y.random(-2,2)),h==null||h.applyImpulse({x:0,y:5+Math.random()*12,z:0})})}}}$r([a(V)],li.prototype,"prefabs",2);var Ur=Object.defineProperty,zr=Object.getOwnPropertyDescriptor,Lr=(o,t,e,s)=>{for(var i=s>1?void 0:s?zr(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&Ur(t,e,i),i};class ee extends u{constructor(){super(...arguments),this.displayName=""}}Lr([a()],ee.prototype,"displayName",2);var Fr=Object.defineProperty,Wr=Object.getOwnPropertyDescriptor,ie=(o,t,e,s)=>{for(var i=s>1?void 0:s?Wr(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&Fr(t,e,i),i};class St extends u{constructor(){super(...arguments),this.objects=[],this.hideContentOnStart=!0,this.index=-1}awake(){this.hideContentOnStart||(this.index=0),this.apply()}next(){this.index++,this.index>=this.objects.length&&(this.index=0),this.apply()}previous(){this.index--,this.index<0&&(this.index=this.objects.length-1),this.apply()}apply(){for(let t=0;t<this.objects.length;t++)this.objects[t].visible=t===this.index;if(this.lable){const t=this.objects[this.index];if(t){const e=w.getComponent(t,ee);this.lable.text=(e==null?void 0:e.displayName)??t.name}}}select(t){this.index=t,this.index=y.clamp(this.index,0,this.objects.length-1),this.apply()}}ie([a(V)],St.prototype,"objects",2);ie([a()],St.prototype,"hideContentOnStart",2);ie([a(gt)],St.prototype,"lable",2);c.add("AspectRatioFitterUI",qt);c.add("CameraGoal",yt);c.add("CameraLayer",ss);c.add("Cannon",rt);c.add("RandomColor",Ht);c.add("ChangeColorOnCollision",ls);c.add("IncreaseShaderSpeedOverTime",Fe);c.add("DebugLOD",Qt);c.add("DepthOfFieldController",wt);c.add("DisableEnvironmentLight",gs);c.add("EmitParticlesOnClick",Ve);c.add("EnforceParameters",Ne);c.add("HTMLButtonClick",Xt);c.add("HTMLMenu",_t);c.add("IFrameContent",ot);c.add("ImageTrackingDownloadUI",Bs);c.add("Networking_ClickToChangeColor",Bt);c.add("Networking_StringArray",It);c.add("Networking_Object",ft);c.add("PerformanceSettings",Yt);c.add("PhysicsCollision",nt);c.add("PhysicsTrigger",at);c.add("PlayAnimationOnCollision",Ze);c.add("PlayAnimationOnTrigger",Xe);c.add("PlayAudioOnCollision",Ye);c.add("ResponsiveContent",Kt);c.add("LoadingSceneRoot",Je);c.add("SceneLoadingEvents",kt);c.add("SceneSwitcherControls",er);c.add("ShowBalloonMessage",ke);c.add("SimpleLeaderboard",$t);c.add("StartPosition",ti);c.add("AutoReset",ei);c.add("SyncedRoomUI",ii);c.add("TimedSpawn",si);c.add("VideoBackground",yr);c.add("ResetPositionOnInterval",lt);c.add("ToggleVisibility",_r);c.add("WireframeMaterial",ri);c.add("XRLifecycleEvents",te);c.add("Arrow",ni);c.add("ArrowShooting",C);c.add("BowArrowTarget",ai);c.add("BowTargetSpawner",li);c.add("VariantInfo",ee);c.add("VariantSwitcher",St);class Vr extends u{onEnable(){const t=w.findObjectOfType(Di);t&&(t.anchoringType="plane",t.planeAnchoringAlignment="vertical")}}var Nr=Object.defineProperty,qr=Object.getOwnPropertyDescriptor,ht=(o,t,e,s)=>{for(var i=s>1?void 0:s?qr(t,e):t,r=o.length-1,n;r>=0;r--)(n=o[r])&&(i=(s?n(t,e,i):n(i))||i);return s&&i&&Nr(t,e,i),i};class K extends u{constructor(){super(...arguments),this.distance=.5,this.fadeDuration=1,this.targetState=!0,this.hideOnStart=!0}createBehaviours(t,e,s){if(e.uuid===this.gameObject.uuid){const i=this.target??this.gameObject;this.hideOnStart&&t.addBehavior(new ae("SetActiveOnProximity_active_"+this.gameObject.name,le.sceneStartTrigger(),he.fadeAction(i,0,!this.targetState))),t.addBehavior(new ae("SetActiveOnProximity_"+this.gameObject.name,le.proximityToCameraTrigger(this.gameObject,this.distance),he.fadeAction(i,this.fadeDuration,this.targetState)))}}}ht([a(V)],K.prototype,"target",2);ht([a()],K.prototype,"distance",2);ht([a()],K.prototype,"fadeDuration",2);ht([a()],K.prototype,"targetState",2);ht([a()],K.prototype,"hideOnStart",2);c.add("CustomUSDSettings",Vr);c.add("FadeOnProximity",K);
